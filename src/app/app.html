<router-outlet></router-outlet>
<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>Rating Assistant</h1>
    <p>Connect to UTR API and calculate your future rating</p>
  </div>

  <!-- Authentication Section -->
  <div *ngIf="showAuthSection()" class="card auth-card">
    <h2>ğŸ” Authentication Required</h2>
    
    <div class="auth-explainer">
      <p>
        <strong>Why do I need this?</strong> UTR Sports doesn't provide a public username/password API. 
        Instead, you'll copy your authentication token from your browser after logging into UTR Sports.
      </p>
      <p class="easy-indicator">âœ… It's easy and takes less than 30 seconds!</p>
    </div>
    
    <div class="auth-steps">
      <h3>ğŸ“‹ Step-by-Step Instructions:</h3>
      
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <strong>Log in to UTR Sports</strong>
          <p>Visit <a href="https://app.utrsports.net" target="_blank" class="utr-link">app.utrsports.net</a> and log in with your username and password</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <strong>Open Developer Tools</strong>
          <p>Press <kbd>F12</kbd> on your keyboard (or right-click â†’ "Inspect")</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <strong>Navigate to Cookies</strong>
          <p>Click on <strong>Application</strong> tab â†’ <strong>Storage</strong> â†’ <strong>Cookies</strong> â†’ <strong>https://app.utrsports.net</strong></p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">4</div>
        <div class="step-content">
          <strong>Find the JWT Cookie</strong>
          <p>Look for a cookie named <code>jwt</code> in the list</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">5</div>
        <div class="step-content">
          <strong>Copy the Token</strong>
          <p>Click on the <code>jwt</code> cookie and copy its <strong>Value</strong> (it's a long string of text)</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">6</div>
        <div class="step-content">
          <strong>Paste Below</strong>
          <p>Paste the token in the field below and click "Authenticate"</p>
        </div>
      </div>
    </div>

    <!-- Video Tutorial Link -->
    <div class="video-tutorial">
      <p>
        ğŸ“º <strong>Need visual help?</strong> 
        <a href="https://www.youtube.com/results?search_query=how+to+view+browser+cookies+developer+tools" target="_blank">
          Watch a tutorial on YouTube
        </a>
      </p>
    </div>
    
    <div class="jwt-input-section">
      <div class="form-group">
        <label for="jwtToken">
          <strong>Paste Your JWT Token Here:</strong>
        </label>
        <textarea 
          id="jwtToken"
          [ngModel]="jwtToken()"
          (ngModelChange)="jwtToken.set($event)"
          placeholder="Paste the long JWT token value here (starts with 'eyJ...')"
          class="jwt-textarea"
          rows="4"></textarea>
        <small class="hint">The token should start with "eyJ" and be very long (hundreds of characters)</small>
      </div>
      
      <button (click)="setAuthToken()" class="btn btn-primary btn-large">
        ğŸ”“ Authenticate
      </button>
    </div>

    <!-- Auth Status Message -->
    <div *ngIf="authMessage()" class="auth-message">
      <div [ngClass]="{
        'success': authMessageType() === 'success',
        'error': authMessageType() === 'error',
        'info-message': authMessageType() === 'info'
      }">
        {{ authMessage() }}
      </div>
    </div>

    <!-- Security Note -->
    <div class="security-note">
      <h4>ğŸ”’ Security Notes:</h4>
      <ul>
        <li>Your token is stored locally in your browser only</li>
        <li>This app doesn't send your token to any external servers (except UTR API)</li>
        <li>Tokens typically expire after 24 hours - you'll need to get a new one</li>
        <li>Never share your JWT token with anyone</li>
      </ul>
    </div>
  </div>

  <!-- Player Selection Section -->
  <div *ngIf="isAuthenticated()" class="card">
    <div class="authenticated-header">
      <h2>Enter Your Player ID</h2>
      <button (click)="logout()" class="btn btn-secondary btn-logout">
        ğŸšª Logout
      </button>
    </div>

    <!-- Player ID Input -->
    <div class="player-id-section">
      <div class="search-input-group">
        <input type="text" 
               [ngModel]="playerId()"
               (ngModelChange)="playerId.set($event)"
               (keyup.enter)="loadPlayerData()"
               placeholder="Enter your UTR Player ID..."
               class="search-input">
        <button (click)="loadPlayerData()" 
                [disabled]="isLoadingData()"
                class="btn btn-primary">
          {{ isLoadingData() ? 'Loading...' : 'Load Data' }}
        </button>
      </div>
      <p class="help-text">
        ğŸ’¡ <strong>How to find your Player ID:</strong><br>
        1. Go to your profile on <a href="https://app.utrsports.net" target="_blank">app.utrsports.net</a><br>
        2. Look at the URL: <code>app.utrsports.net/profiles/<strong>1234567</strong></code><br>
        3. The number at the end is your Player ID
      </p>
    </div>

    <!-- Upload Status -->
    <div *ngIf="uploadStatus()" class="upload-status">
      <div [ngClass]="{
        'success': uploadStatusType() === 'success',
        'error': uploadStatusType() === 'error',
        'loading-message': uploadStatusType() === 'loading'
      }">
        <span *ngIf="uploadStatusType() === 'loading'" class="loading"></span>
        <span *ngIf="uploadStatusType() === 'success'">âœ…</span>
        <span *ngIf="uploadStatusType() === 'error'">âŒ</span>
        {{ uploadStatus() }}
      </div>
    </div>
  </div>

  <!-- Action Buttons Section -->
  <div *ngIf="showActionButtons()" class="card action-buttons-card">
    <h2>What would you like to do?</h2>
    <div class="action-buttons-section">
      <button (click)="openTennisWrapped()" class="btn-action btn-wrapped">
        <span class="action-icon">ğŸ¾</span>
        <span class="action-title">Tennis Wrapped</span>
        <span class="action-description">View your year in tennis</span>
      </button>
      
      <button (click)="openUTRPredictor()" class="btn-action btn-predictor">
        <span class="action-icon">ğŸ¯</span>
        <span class="action-title">UTR Predictor</span>
        <span class="action-description">Calculate future rating</span>
      </button>
    </div>
  </div>

  <!-- Tennis Wrapped Component -->
  <app-tennis-wrapped 
    [matches]="matchData()" 
    [currentRating]="currentRating()">
  </app-tennis-wrapped>

  <!-- Future Rating Calculator -->
  <div *ngIf="showCalculator()" class="card calculator-overlay">
    <div class="calculator-header">
      <h2>UTR Predictor Tool</h2>
      <button (click)="closeUTRPredictor()" class="btn-close">âœ•</button>
    </div>
    <div class="calculator-header">
      <h2>UTR Predictor Tool</h2>
      <button (click)="closeUTRPredictor()" class="btn-close">âœ•</button>
    </div>
    
    <form (ngSubmit)="calculateFutureRating()" #ratingForm="ngForm">
      <div class="form-group">
        <label for="opponentRating">Opponent's UTR Rating:</label>
        <input type="number" 
               id="opponentRating"
               name="opponentRating"
               [ngModel]="opponentRating()"
               (ngModelChange)="opponentRating.set($event)"
               step="0.01" 
               min="0" 
               max="16" 
               required 
               placeholder="e.g., 4.25"
               #opponentRatingInput="ngModel">
      </div>
      
      <div class="form-group">
        <label for="setScores">Set Scores (comma-separated, format: 6-4, 7-5):</label>
        <input type="text" 
               id="setScores"
               name="setScores"
               [ngModel]="setScores()"
               (ngModelChange)="setScores.set($event)"
               required 
               placeholder="e.g., 6-4, 7-5, 6-3"
               #setScoresInput="ngModel">
      </div>

      <div class="form-actions">
        <button type="submit" 
                class="btn btn-primary" 
                [disabled]="!ratingForm.form.valid || calculating()">
          <span *ngIf="calculating()" class="loading"></span>
          {{ calculating() ? 'Calculating...' : 'Calculate Future Rating' }}
        </button>
        
        <button type="button" 
                class="btn btn-secondary" 
                (click)="resetForm()">
          Reset
        </button>
      </div>
    </form>

    <!-- Calculation Results -->
    <div *ngIf="calculationResults()" class="result-section">
      <h3>ğŸ¯ Match Analysis</h3>
      
      <div class="results-grid">
        <div class="result-item">
          <h4>Expected Win %</h4>
          <div class="result-number">{{ calculationResults()!.expectedResult | number:'1.1-1' }}%</div>
        </div>
        <div class="result-item">
          <h4>Actual Win %</h4>
          <div class="result-number">{{ calculationResults()!.actualResult | number:'1.1-1' }}%</div>
        </div>
        <div class="result-item">
          <h4>Match Rating</h4>
          <div class="result-number">{{ calculationResults()!.matchRating | number:'1.2-2' }}</div>
        </div>
        <div class="result-item">
          <h4>Future UTR</h4>
          <div class="result-number">{{ calculationResults()!.futureRating | number:'1.2-2' }}</div>
        </div>
      </div>
      
      <div class="analysis-section">
        <p><strong>Performance Analysis:</strong></p>
        <p>
          <span [ngClass]="calculationResults()!.performedBetter ? 'performance-good' : 'performance-below'">
            {{ calculationResults()!.performedBetter ? 'ğŸŸ¢ You performed better than expected!' : 'ğŸŸ¡ You performed below expectations.' }}
          </span>
        </p>
        <p>
          <strong>Rating Change:</strong> 
          <span [ngClass]="calculationResults()!.ratingChange >= 0 ? 'rating-increase' : 'rating-decrease'">
            {{ calculationResults()!.ratingChange >= 0 ? '+' : '' }}{{ calculationResults()!.ratingChange | number:'1.2-2' }} points
          </span>
        </p>
      </div>
    </div>
  </div>
</div>
